---
layout: post
title: 悲剧的内核
categories:
- 计算机技术
tags:
- linux
- 内核
published: true
comments: true
---
<p>前几天手痒，放着好好的ubuntu 10.04 lts不用，升级到了10.10，又升级到了11.04，结果却令人很失望。<br />
默认软件更换一大堆，有一点不适应。特别是unity，要说爱它真的很难啊。另外以前配置好的prism也不能用了，真是很郁闷。<br />
最大的问题还是不能关机！每次无论用图形界面关还是输入各种命令都关不掉，卡在某处，于是只好直接按电源。我怕数据丢失，每次都先输入sync命令三四遍才按掉。可是，依然时有磁盘检查的事。<!--more-->
于是着手解决问题。检查系统日志，发现每次都是卡在一个特定的位置，内核出问题的可能性比较大。根据回忆（==），升到10.10的时候用的是2.6.35内核，可以正常关机，而11.04的2.6.38就不能了。本来这事很好办，删除新内核用旧的就行了。可就是怪我有洁癖，早把旧的用ubuntu tweak删了，这下可惨，apt貌似是没法给软件降级。苦恼的我想到了自己编译内核。我从kernel官网下载了2.6.35的源码包自己编译，在配置的时候回答了一大堆y/n问题，最终安装好了。重启在grub中选择刚装好的，发现不能启动，貌似是无法挂载硬盘，这可把我气坏了。说原因么，可能是问题回答错了吧。它问的都是些超级底层的问题，比如说你的usb设备用的是什么控制器，主板是否支持某种功能云云，要想全部答对可能性还真的不大。于是就出错了。所以劝各位如果没十足的把握没事别自己编译内核，太有难度了。<br />
就在绝望之时，我想到了ubuntu.srt.cn（杭州的一个最近的ubuntu镜像站）。进去一翻，果然找到了2.6.35的内核二进制安装包。于是装好。（次序：先是带个“all”的，再是headers的另一个，最后image。）重启，关掉。顺利关机。<br />
惟一的缺憾就是无线网卡驱动rt3090装不上了。目前无力解决，大不了把路由器拿过来用。<br />
这件事可以算作是一个教训，升级系统有风险，真心希望ubuntu能考虑一下像arch一样的平滑升级，毕竟系统的稳定性也是很重要的。</p>
