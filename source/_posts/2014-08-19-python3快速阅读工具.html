---
layout: post
title: Python3快速阅读工具
categories:
- 计算机技术
tags:
- Geek
- python
- 编程
- 自由软件
- 读书
published: true
comments: true
---
<p>好吧，最近手停不下来了。今天看到网上有个名叫“<a title="快读啦" href="http://kuaidula.com/" target="_blank">快读啦</a>”的快速阅读工具，号称能“让你不用移动眼睛，不用靠近屏幕就能阅读，保护视力”，觉得确实有用。可是它只有网页版，于是我便尝试用Python3写了一个。可以读txt电子书。Linux测试通过。<!--more-->
<h2>原理</h2>
从txt文件读取一个大字符串，每次只取一点点，每隔一段时间就移动切片。使用Tkinter作为图形界面（最近老是和GUI过不去……），chardet判断文本编码，突发奇想地用了getopt接收参数，还写了个帮助。
<h2>使用说明</h2>
<pre>Usage: python3 SpeadReading.py [options] FILENAME
Press any key to resume or pause.
Option list:
-p NUM, --pos=NUM Specify beginning position. 0 by default. (Useful as a bookmark)
-s NUM, --speed=NUM Specify the number of hanzi per minute. 750 by default
-w NUM, --width=NUM Specify the width of display. 3 by default
-z NUM, --size=NUM Specify the font size. 72 by default
-h, --help Show this help
Position number will be given every time when exit.</pre>
总之任意键开始或暂停，退出时有当前位置提醒，下次就可以当做书签参数输入了。
<h2>代码</h2>
<pre class="brush:python">#!/usr/bin/env python3
# -*- coding:utf-8 -*-
'''SpeedReading.py
Speed up your reading!
Author: Tianhu Zhang &lt;zszth@126.com&gt;
Run with option -h or --help to show help.
'''
import tkinter as tk
from tkinter import font
import chardet
import sys
import getopt
import os</pre></p>

<p># Settings.<br />
hanzi_per_min = 750<br />
hanzi_at_a_time = 3<br />
hanzi_size = 72</p>

<p># Constants.<br />
pos = 0<br />
txt = '废话还是不要多说的好，除非你是在凑字数。'<br />
reading = False</p>

<p># Getting variants.<br />
def help():<br />
    print('''SpeedReading.py<br />
Usage: python3 SpeadReading.py [options] FILENAME<br />
Press any key to resume or pause.<br />
Option list:<br />
    -p NUM, --pos=NUM   Specify beginning position. 0 by default. (Useful as a bookmark)<br />
    -s NUM, --speed=NUM Specify the number of hanzi per minute. 750 by default<br />
    -w NUM, --width=NUM Specify the width of display. 3 by default<br />
    -z NUM, --size=NUM  Specify the font size. 72 by default<br />
    -h,     --help      Show this help<br />
Position number will be given every time when exit.''')<br />
if len(sys.argv) &lt; 2:<br />
    file_path = input('Input file name (or path): &gt;')<br />
    pos = int(input('Input position: &gt;'))<br />
else:<br />
    try:<br />
        options,args = getopt.getopt(sys.argv[1:], 'hp:s:w:z:', ['help', 'pos=', 'speed=', 'width=', 'size='])<br />
        if args:<br />
            file_path = args[0]<br />
            if not os.path.isfile(file_path):<br />
                print('File not found.')<br />
                exit()<br />
            for opt, value in options:<br />
                if opt in ['-p', '--pos']:<br />
                    pos = int(value)<br />
                if opt in ['-s', '--speed']:<br />
                    hanzi_per_min = int(value)<br />
                if opt in ['-w', '--width']:<br />
                    hanzi_at_a_time = int(value)<br />
                if opt in ['-z', '--size']:<br />
                    hanzi_size = int(value)<br />
        else:<br />
            help()<br />
            exit()<br />
    except getopt.GetoptError:<br />
        help()<br />
        exit()</p>

<p># Loading file.<br />
with open(file_path, mode = 'rb') as f:<br />
    # print(chardet.detect(f.read())['encoding'])<br />
    data = f.read()<br />
    code = chardet.detect(data)['encoding']<br />
    txt = data.decode(code)<br />
txt = '文始&gt;' + txt.replace('\n', '  ') + '&lt;文末'</p>

<p># Preparing window.<br />
root = tk.Tk()<br />
root.title("速读 " + file_path)<br />
show_font = font.Font(family = 'serif', size = hanzi_size, weight = 'normal')<br />
show = tk.Label(root, text = '预备！', font = show_font)<br />
def toogle(event):<br />
    global reading<br />
    reading = not reading<br />
root.bind('&lt;KeyPress&gt;', toogle)<br />
show.pack()<br />
def timer():<br />
    global pos<br />
    if reading and pos &lt; len(txt) - (hanzi_at_a_time - 1):<br />
        show.config(text = txt[pos: pos + hanzi_at_a_time])<br />
        pos = pos + 1<br />
    root.after(int(1000 * 60 / hanzi_per_min), timer)</p>

<p># Start.<br />
timer()<br />
print('Press any key to resume or pause...')<br />
show.config(text = txt[pos: pos + hanzi_at_a_time])<br />
root.mainloop()<br />
print('Stop at position {0}.'.format(pos))<br />
if pos == len(txt) - (hanzi_at_a_time - 1):<br />
    print('Reading finished.')

&nbsp;</p>
